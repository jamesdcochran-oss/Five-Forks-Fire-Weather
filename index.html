<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Five Forks Fire Weather — Demo</title>

    <!-- Tailwind (CDN) -->
    <script>
      window.tailwind = { darkMode: 'class' };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React / ReactDOM UMD -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel (so we can write JSX in-browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Recharts UMD (charts) -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>

    <!-- Minimal dark theme background gradient -->
    <style>
      html, body, #root { height: 100%; }
      body { margin: 0; }
    </style>
  </head>
  <body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-slate-100">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;
      const {
        AreaChart, Area, Line, XAxis, YAxis, CartesianGrid, Tooltip,
        ResponsiveContainer, Legend
      } = Recharts;

      /* ---------- Tiny UI primitives ---------- */
      const cn = (...a) => a.filter(Boolean).join(' ');
      const Card = ({ className, children }) => (
        <div className={cn('rounded-xl border bg-slate-800/50 border-slate-700/50 backdrop-blur-sm', className)}>{children}</div>
      );
      const CardHeader = ({ className, children }) => <div className={cn('px-4 pt-4 pb-2', className)}>{children}</div>;
      const CardTitle = ({ className, children }) => <h3 className={cn('text-white font-semibold text-base', className)}>{children}</h3>;
      const CardContent = ({ className, children }) => <div className={cn('px-4 pb-4', className)}>{children}</div>;
      const Badge = ({ className, children }) => (
        <span className={cn('inline-flex items-center rounded-md px-2 py-1 text-xs font-medium bg-slate-700/40 text-slate-200', className)}>{children}</span>
      );
      const Button = ({ className, children, ...props }) => (
        <button {...props} className={cn('inline-flex items-center justify-center gap-2 rounded-lg px-3 py-2 bg-orange-500 text-white hover:bg-orange-600 disabled:opacity-60', className)}>{children}</button>
      );
      const Progress = ({ value, className }) => {
        const pct = Math.max(0, Math.min(100, value ?? 0));
        return (
          <div className={cn('w-full h-2 rounded bg-slate-700/50', className)}>
            <div className="h-2 rounded bg-orange-500" style={{ width: pct + '%' }} />
          </div>
        );
      };

      /* ---------- Helpers ---------- */
      const AQI_STYLES = {
        'Good': { bg: 'bg-green-500/20', text: 'text-green-400', border: 'border-green-500/30' },
        'Moderate': { bg: 'bg-yellow-500/20', text: 'text-yellow-400', border: 'border-yellow-500/30' },
        'Unhealthy for Sensitive Groups': { bg: 'bg-orange-500/20', text: 'text-orange-400', border: 'border-orange-500/30' },
        'Unhealthy': { bg: 'bg-red-500/20', text: 'text-red-400', border: 'border-red-500/30' },
        'Very Unhealthy': { bg: 'bg-purple-500/20', text: 'text-purple-400', border: 'border-purple-500/30' },
        'Hazardous': { bg: 'bg-red-900/30', text: 'text-red-300', border: 'border-red-800/50' },
      };
      const DANGER_STYLES = {
        'Low': 'bg-green-500/20 text-green-400 border-green-500/30',
        'Moderate': 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30',
        'High': 'bg-orange-500/20 text-orange-400 border-orange-500/30',
        'Very High': 'bg-red-500/20 text-red-400 border-red-500/30',
        'Extreme': 'bg-purple-500/20 text-purple-400 border-purple-500/30',
      };
      const timeSince = (d) => {
        const diff = Math.floor((Date.now() - d.getTime()) / 60000);
        if (diff <= 0) return 'Just now';
        if (diff === 1) return '1 min ago';
        return diff + ' min ago';
      };
      const calcDanger = (h, wind, t, kbdi) => {
        let s = 0; if (h < 30) s += 2; if (wind > 15) s += 2; if (t > 85) s += 1; if (kbdi > 400) s += 2; if (kbdi > 600) s += 1; if (h < 20) s += 1;
        if (s >= 6) return { cls: '5', lvl: 'Extreme', css: DANGER_STYLES['Extreme'], icon: '🔥' };
        if (s >= 5) return { cls: '4', lvl: 'Very High', css: DANGER_STYLES['Very High'], icon: '🔥' };
        if (s >= 3) return { cls: '3', lvl: 'High', css: DANGER_STYLES['High'], icon: '⚠️' };
        if (s >= 2) return { cls: '2', lvl: 'Moderate', css: DANGER_STYLES['Moderate'], icon: '〰️' };
        return { cls: '1', lvl: 'Low', css: DANGER_STYLES['Low'], icon: '✅' };
      };

      /* ---------- Mock Data Loader ---------- */
      function useMockData(){
        const [lastUpdate, setLastUpdate] = useState(new Date());
        const [isRefreshing, setIsRefreshing] = useState(false);
        const [airQuality, setAir] = useState(null);
        const [incidents, setInc] = useState([]);
        const [stations, setSta] = useState([]);
        const [fireWeather, setFW] = useState(null);
        const [drought, setDr] = useState(null);
        const [alerts, setAl] = useState([]);

        const load = () => {
          setAir({ aqi: 58, category: 'Moderate', primary_pollutant: 'PM2.5', pm25: 14, temperature: 78, humidity: 42, wind_speed: 9, wind_direction: 'NW', fire_danger_level: 'High' });
          setInc([{ id: 'a1', incident_name: 'Piney Ridge', distance_miles: 34, acres: 125, containment: 45, frp: 30, confidence: 'high', status: 'active', satellite: 'VIIRS', created_date: new Date().toISOString() }]);
          const names = ['Jetersville','Amelia Court House','Burkeville','Blackstone','Ebony','Brodnax','Emporia','Dinwiddie','Carson','Sutherland','Prince George'];
          setSta(names.map((n,i)=>({ id:'st-'+i, name:n, location:'VA', temperature:70+((i*3)%12), humidity:35+((i*7)%40), wind_speed:5+((i*2)%12), wind_gust:8+((i*3)%18), dew_point:55+(i%6), kbdi:350+((i*30)%300), aqi:40+((i*10)%70), last_updated:new Date().toISOString() })));
          setFW({ source:'WFAS/NWS', fire_danger_rating:'High', burning_index:63, spread_component:51, energy_release:42, ignition_component:18, ten_hour_fuel_moisture:6, hundred_hour_fuel_moisture:7, kbdi:447, forecast_text:'Warm, dry, and breezy this afternoon. RH 28–35%. 20-ft winds WNW 12–18 mph with gusts 22–28 mph.', red_flag_warning:false });
          setDr({ drought_level: 'D1 – Moderate', percent_area_affected: 24, conditions_summary: 'Dry topsoil, stressed vegetation in sandy soils.', impacts: 'Voluntary water conservation recommended.'});
          setAl([{ id:'al1', alert_type:'Fire Weather Watch', severity:'Moderate', headline:'Elevated fire weather conditions Wednesday afternoon', description:'West winds 15–20 mph with gusts to 30 mph, RH 25–30%. Fine fuels are very dry.', instruction:'Avoid outdoor burning. Secure trailer chains.', affected_zones:['Amelia','Dinwiddie','Nottoway','Prince George'], onset:new Date(Date.now()+2*3600e3).toISOString(), expires:new Date(Date.now()+8*3600e3).toISOString(), is_active:true }]);
          setLastUpdate(new Date());
        };
        useEffect(()=>{ load(); const t=setInterval(load, 15*60*1000); return ()=>clearInterval(t); },[]);
        const refresh = async()=>{ setIsRefreshing(true); await new Promise(r=>setTimeout(r,600)); load(); setIsRefreshing(false); };
        return { lastUpdate, isRefreshing, refresh, airQuality, incidents, stations, fireWeather, drought, alerts };
      }

      /* ---------- Feature Components ---------- */
      function MetricsCard({ title, value, unit, status, description }){
        const statusColors = { good:'bg-green-500/20 text-green-400', moderate:'bg-yellow-500/20 text-yellow-400', warning:'bg-orange-500/20 text-orange-400', danger:'bg-red-500/20 text-red-400' };
        return (
          <Card className="relative overflow-hidden hover:border-orange-500/30 transition-all">
            <div className="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-orange-500/10 to-transparent rounded-full blur-2xl" />
            <CardHeader className="pb-2">
              <div className="flex items-start justify-between">
                <div>
                  <CardTitle className="text-sm text-slate-400">{title}</CardTitle>
                  {description && <p className="text-xs text-slate-500 mt-1">{description}</p>}
                </div>
                <div className="p-2.5 rounded-xl bg-orange-500/10">🔥</div>
              </div>
            </CardHeader>
            <CardContent>
              <div className="flex items-baseline gap-2">
                <span className="text-3xl font-bold text-white">{value}</span>
                {unit && <span className="text-lg text-slate-400">{unit}</span>}
              </div>
              {status && <div className="mt-3"><Badge className={cn('border-0 font-medium', statusColors[status])}>{status[0].toUpperCase()+status.slice(1)}</Badge></div>}
            </CardContent>
          </Card>
        );
      }

      function AirQualityCard({ data }){
        if(!data){
          return (<Card><CardHeader><CardTitle>Air Quality</CardTitle></CardHeader><CardContent><p className="text-slate-400">Loading air quality data…</p></CardContent></Card>);
        }
        const style = AQI_STYLES[data.category] || AQI_STYLES['Good'];
        return (
          <Card className={cn('border-2 hover:shadow-lg hover:shadow-orange-500/10', style.border)}>
            <CardHeader>
              <div className="flex items-center justify-between">
                <CardTitle>Air Quality Index</CardTitle>
                <Badge className={cn(style.bg, style.text, 'border-0 font-bold px-3 py-1')}>{data.category}</Badge>
              </div>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="text-center py-4">
                <div className="text-6xl font-bold text-white mb-2">{data.aqi}</div>
                <p className="text-slate-400 text-sm">Current AQI Level</p>
                <Progress value={(data.aqi/500)*100} className="mt-4" />
              </div>
              <div className="grid grid-cols-2 gap-4 pt-4 border-t border-slate-700/50 text-sm">
                <div><div className="text-slate-400 text-xs">Wind Speed</div><p className="text-white font-semibold">{data.wind_speed} mph</p><p className="text-slate-500 text-xs">{data.wind_direction}</p></div>
                <div><div className="text-slate-400 text-xs">Humidity</div><p className="text-white font-semibold">{data.humidity}%</p></div>
                <div><div className="text-slate-400 text-xs">Temperature</div><p className="text-white font-semibold">{data.temperature}°F</p></div>
                <div><div className="text-slate-400 text-xs">PM2.5</div><p className="text-white font-semibold">{data.pm25} μg/m³</p></div>
              </div>
              <div className={cn('mt-4 p-3 rounded-lg border', style.bg, style.border)}>
                <p className="text-xs text-slate-300 font-medium">Fire Danger Level</p>
                <p className={cn('text-lg font-bold mt-1', style.text)}>{data.fire_danger_level}</p>
              </div>
            </CardContent>
          </Card>
        );
      }

      function ActiveAlerts({ incidents }){
        if(!incidents?.length){
          return (
            <Card>
              <CardHeader><CardTitle>Active Fire Incidents</CardTitle></CardHeader>
              <CardContent>
                <div className="text-center py-8">
                  <div className="w-16 h-16 bg-green-500/10 rounded-full flex items-center justify-center mx-auto mb-3">✅</div>
                  <p className="text-green-400 font-semibold">All Clear</p>
                  <p className="text-slate-500 text-sm mt-1">No active fire incidents detected</p>
                </div>
              </CardContent>
            </Card>
          );
        }
        const statusColor = (s)=> s==='active'?'bg-red-500/20 text-red-400 border-red-500/30': s==='contained'?'bg-yellow-500/20 text-yellow-400 border-yellow-500/30': s==='controlled'?'bg-blue-500/20 text-blue-400 border-blue-500/30':'bg-slate-500/20 text-slate-400';
        const confColor = (c)=> c==='high'?'text-red-400': c==='nominal'?'text-yellow-400':'text-slate-400';
        return (
          <Card className="hover:border-orange-500/30 transition-all">
            <CardHeader>
              <div className="flex items-center justify-between">
                <CardTitle>Active Fire Incidents</CardTitle>
                <Badge className="bg-orange-500/20 text-orange-400 border-0 font-bold">{incidents.length}</Badge>
              </div>
            </CardHeader>
            <CardContent>
              <div className="space-y-3 max-h-96 overflow-auto pr-1">
                {incidents.map((x)=> (
                  <div key={x.id} className="p-4 rounded-lg bg-slate-900/50 border border-slate-700/50 hover:border-orange-500/30">
                    <div className="flex items-start justify-between mb-2">
                      <div>
                        <h4 className="font-semibold text-white">{x.incident_name}</h4>
                        <div className="mt-1 text-xs text-slate-400">📍 {x.distance_miles} miles away</div>
                      </div>
                      <Badge className={cn('border', statusColor(x.status))}>{x.status}</Badge>
                    </div>
                    <div className="grid grid-cols-2 gap-3 text-sm">
                      <div><p className="text-slate-500 text-xs">Acres Burned</p><p className="text-white font-semibold">{x.acres ?? 'N/A'}</p></div>
                      <div><p className="text-slate-500 text-xs">Containment</p><p className="text-white font-semibold">{x.containment ?? 0}%</p></div>
                      <div><p className="text-slate-500 text-xs">Fire Power</p><div className="flex items-center gap-1"><span className={cn(confColor(x.confidence))}>▲</span><p className="text-white font-semibold">{x.frp} MW</p></div></div>
                      <div><p className="text-slate-500 text-xs">Confidence</p><p className={cn('font-semibold', confColor(x.confidence))}>{x.confidence}</p></div>
                    </div>
                    <div className="mt-3 pt-3 border-t border-slate-700/50 text-xs text-slate-500">Source: {x.satellite} • {new Date(x.created_date).toLocaleString()}</div>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        );
      }

      function WeatherStationsList({ stations }){
        if(!stations?.length){
          return (<Card><CardHeader><CardTitle>Regional Weather Stations</CardTitle></CardHeader><CardContent><p className="text-slate-400">Fetching weather data…</p></CardContent></Card>);
        }
        return (
          <Card>
            <CardHeader><CardTitle>Regional Weather Stations</CardTitle></CardHeader>
            <CardContent>
              <div className="space-y-3 max-h-96 overflow-auto pr-1">
                {stations.map((s)=>{
                  const danger = calcDanger(s.humidity, s.wind_speed, s.temperature, s.kbdi);
                  return (
                    <div key={s.id} className="p-4 rounded-lg bg-slate-900/50 border border-slate-700/50 hover:border-orange-500/30">
                      <div className="flex items-start justify-between mb-3">
                        <div>
                          <h4 className="font-semibold text-white flex items-center gap-2">{s.name} <span className="text-lg">{danger.icon}</span></h4>
                          <p className="text-xs text-slate-400">{s.location}</p>
                        </div>
                        {typeof s.temperature==='number' && (
                          <div className="text-right">
                            <p className="text-2xl font-bold text-white">{Math.round(s.temperature)}°F</p>
                            {s.dew_point!=null && <p className="text-xs text-slate-500">Dew {Math.round(s.dew_point)}°</p>}
                          </div>
                        )}
                      </div>

                      <div className="mb-3"><Badge className={cn('border font-bold', danger.css)}>{danger.cls} - {danger.lvl}</Badge></div>

                      <div className="grid grid-cols-4 gap-3 text-sm">
                        <div><div className="text-slate-500 text-xs mb-1">RH</div><p className="text-white font-semibold">{Math.round(s.humidity)}%</p></div>
                        <div><div className="text-slate-500 text-xs mb-1">Wind</div><p className="text-white font-semibold">{Math.round(s.wind_speed)} mph</p>{s.wind_gust && (<p className="text-xs text-slate-400">G{s.wind_gust}</p>)}</div>
                        <div><div className="text-slate-500 text-xs mb-1">KBDI</div><p className="text-white font-semibold">{s.kbdi}</p></div>
                        <div><div className="text-slate-500 text-xs mb-1">AQI</div><p className="text-white font-semibold">{s.aqi}</p></div>
                      </div>

                      <div className="p-2 bg-slate-900/70 rounded border border-slate-700/30 font-mono text-xs mt-3">
                        <p className="text-slate-300">Temp {Math.round(s.temperature)}°F | RH {Math.round(s.humidity)}% | Dew {Math.round(s.dew_point)}° | Wind {Math.round(s.wind_speed)} mph{s.wind_gust?` | Gust ${Math.round(s.wind_gust)}`:''} | KBDI {s.kbdi} | AQI {s.aqi}</p>
                      </div>

                      <div className="mt-3 pt-3 border-t border-slate-700/50"><p className="text-xs text-slate-500">Updated: {new Date(s.last_updated).toLocaleTimeString()}</p></div>
                    </div>
                  );
                })}
              </div>
            </CardContent>
          </Card>
        );
      }

      function TrendsChart(){
        const trendData = [
          { date:'Mon', aqi:45, fires:0, temp:72 },
          { date:'Tue', aqi:52, fires:1, temp:75 },
          { date:'Wed', aqi:48, fires:1, temp:78 },
          { date:'Thu', aqi:55, fires:2, temp:80 },
          { date:'Fri', aqi:68, fires:3, temp:82 },
          { date:'Sat', aqi:72, fires:2, temp:79 },
          { date:'Sun', aqi:58, fires:1, temp:76 },
        ];
        return (
          <Card>
            <CardHeader><CardTitle>7‑Day Trends</CardTitle></CardHeader>
            <CardContent>
              <ResponsiveContainer width="100%" height={300}>
                <AreaChart data={trendData}>
                  <defs>
                    <linearGradient id="colorAqi" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="5%" stopColor="#f97316" stopOpacity={0.3} />
                      <stop offset="95%" stopColor="#f97316" stopOpacity={0} />
                    </linearGradient>
                    <linearGradient id="colorFires" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="5%" stopColor="#ef4444" stopOpacity={0.3} />
                      <stop offset="95%" stopColor="#ef4444" stopOpacity={0} />
                    </linearGradient>
                  </defs>
                  <CartesianGrid strokeDasharray="3 3" stroke="#334155" opacity={0.3} />
                  <XAxis dataKey="date" stroke="#94a3b8" style={{ fontSize: '12px' }} />
                  <YAxis stroke="#94a3b8" style={{ fontSize: '12px' }} />
                  <Tooltip contentStyle={{ backgroundColor: '#1e293b', border: '1px solid #334155', borderRadius: '8px', color: '#fff' }} />
                  <Legend wrapperStyle={{ color: '#94a3b8', fontSize: '12px' }} />
                  <Area type="monotone" dataKey="aqi" stroke="#f97316" fillOpacity={1} fill="url(#colorAqi)" name="Air Quality Index" />
                  <Area type="monotone" dataKey="fires" stroke="#ef4444" fillOpacity={1} fill="url(#colorFires)" name="Active Fires" />
                </AreaChart>
              </ResponsiveContainer>
            </CardContent>
          </Card>
        );
      }

      function NWSAlertBanner({ alerts }){
        if(!alerts?.length){
          return (
            <div className="rounded-lg border-2 border-green-500/30 bg-green-500/10 p-4">
              <div className="flex items-center gap-3">
                <div className="text-green-400 text-xl">✅</div>
                <div>
                  <h3 className="text-green-400 font-bold">NWS Alert Status: All Clear</h3>
                  <p className="text-slate-300 text-sm mt-1">No active fire weather alerts for AKQ (Wakefield) counties</p>
                </div>
              </div>
            </div>
          );
        }
        return (
          <div className="space-y-4">
            {alerts.map((a)=>{
              const isRedFlag = a.alert_type?.toLowerCase().includes('red flag');
              const isFW = a.alert_type?.toLowerCase().includes('fire weather');
              const wrap = cn('rounded-lg border-2 p-4 backdrop-blur-sm', isRedFlag? 'bg-red-500/10 border-red-500/50 shadow-lg shadow-red-500/20' : isFW? 'bg-orange-500/10 border-orange-500/50' : 'bg-yellow-500/10 border-yellow-500/50');
              return (
                <div key={a.id} className={wrap}>
                  <div className="flex items-start gap-3">
                    <div className={cn('text-xl', isRedFlag? 'text-red-400':'text-orange-400')}>{isRedFlag?'⚠️':'ℹ️'}</div>
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-2">
                        <h3 className={cn('font-bold text-lg', isRedFlag? 'text-red-400':'text-orange-400')}>🚨 {a.alert_type}</h3>
                        <Badge className={cn(a.severity==='Extreme'?'bg-purple-500/20 text-purple-400': a.severity==='Severe'?'bg-red-500/20 text-red-400':'bg-orange-500/20 text-orange-400')}>{a.severity}</Badge>
                      </div>
                      <p className="text-slate-300 text-sm mb-3"><strong>{a.headline}</strong></p>
                      {a.description && <p className="text-slate-400 text-sm mb-3">{a.description}</p>}
                      {a.instruction && (
                        <div className="p-3 bg-slate-900/50 rounded-lg border border-slate-700/50 mb-3">
                          <p className="text-xs text-slate-500 uppercase font-semibold mb-1">Instructions</p>
                          <p className="text-sm text-slate-300">{a.instruction}</p>
                        </div>
                      )}
                      {!!a.affected_zones?.length && (
                        <div className="flex gap-2 flex-wrap mb-2">
                          {a.affected_zones.map((z,i)=> <Badge key={i} className="border border-slate-600/50 text-xs bg-slate-800/50">{z}</Badge>)}
                        </div>
                      )}
                      <div className="flex gap-4 text-xs text-slate-500 mt-2">
                        {a.onset && <span>Starts: {new Date(a.onset).toLocaleString()}</span>}
                        {a.expires && <span>Expires: {new Date(a.expires).toLocaleString()}</span>}
                      </div>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        );
      }

      function FireWeatherPanel({ fireWeather, drought }){
        const danger = fireWeather?.fire_danger_rating || 'Low';
        return (
          <div className="space-y-6">
            <Card className={cn('border-2', fireWeather?.red_flag_warning? 'border-red-500/50 shadow-lg shadow-red-500/20' : 'border-slate-700/50')}>
              <CardHeader><CardTitle>Fire Weather Outlook</CardTitle></CardHeader>
              <CardContent className="space-y-4">
                {fireWeather?.red_flag_warning && (
                  <div className="p-4 bg-red-500/10 border-2 border-red-500/50 rounded-lg">
                    <div className="flex items-center gap-2 text-red-400 font-bold mb-2">⚠️ RED FLAG WARNING ACTIVE</div>
                    <p className="text-sm text-slate-300">Critical fire weather conditions exist. Avoid any outdoor burning.</p>
                  </div>
                )}
                <div className="text-center py-2">
                  <p className="text-slate-400 text-sm mb-2">Current Fire Danger</p>
                  <Badge className={cn('text-2xl font-bold px-6 py-2 border', DANGER_STYLES[danger])}>{danger}</Badge>
                </div>
                {typeof fireWeather?.burning_index==='number' && (
                  <div>
                    <div className="flex justify-between text-sm mb-2"><span className="text-slate-400">Burning Index</span><span className="text-white font-semibold">{fireWeather.burning_index}</span></div>
                    <Progress value={Math.min(fireWeather.burning_index, 100)} />
                  </div>
                )}
                <div className="grid grid-cols-3 gap-3 text-sm">
                  {typeof fireWeather?.ten_hour_fuel_moisture==='number' && (<div><p className="text-slate-500 text-xs">10‑hr Fuel</p><p className="text-white font-semibold">{fireWeather.ten_hour_fuel_moisture}%</p></div>)}
                  {typeof fireWeather?.hundred_hour_fuel_moisture==='number' && (<div><p className="text-slate-500 text-xs">100‑hr Fuel</p><p className="text-white font-semibold">{fireWeather.hundred_hour_fuel_moisture}%</p></div>)}
                  {typeof fireWeather?.kbdi==='number' && (<div><p className="text-slate-500 text-xs">KBDI</p><p className="text-white font-semibold">{fireWeather.kbdi}</p></div>)}
                </div>
                {fireWeather?.forecast_text && (<div className="mt-2 p-3 bg-slate-900/50 rounded-lg border border-slate-700/50"><p className="text-xs text-slate-400 mb-1">Forecast</p><p className="text-sm text-slate-300">{fireWeather.forecast_text}</p></div>)}
                <div className="text-xs text-slate-500 pt-2 border-t border-slate-700/50">Data from WFAS & National Weather Service</div>
              </CardContent>
            </Card>
            {drought && (
              <Card>
                <CardHeader><CardTitle>Drought Status</CardTitle></CardHeader>
                <CardContent className="space-y-4">
                  <div className="text-center"><p className="text-slate-400 text-sm mb-2">Current Classification</p><Badge className="text-lg font-bold px-4 py-2 bg-amber-500/20 text-amber-400 border-amber-500/30">{drought.drought_level || 'Normal'}</Badge></div>
                  {typeof drought.percent_area_affected==='number' && (
                    <div>
                      <div className="flex justify-between text-sm mb-2"><span className="text-slate-400">Area Affected</span><span className="text-white font-semibold">{drought.percent_area_affected}%</span></div>
                      <Progress value={drought.percent_area_affected} />
                    </div>
                  )}
                  {drought.conditions_summary && (<div className="p-3 bg-slate-900/50 rounded-lg border border-slate-700/50"><p className="text-sm text-slate-300">{drought.conditions_summary}</p></div>)}
                  {drought.impacts && (<div className="p-3 bg-amber-500/5 rounded-lg border border-amber-500/20"><p className="text-xs text-slate-400 mb-1">Impacts</p><p className="text-sm text-slate-300">{drought.impacts}</p></div>)}
                  <div className="text-xs text-slate-500 pt-3 border-t border-slate-700/50">Data from US Drought Monitor</div>
                </CardContent>
              </Card>
            )}
          </div>
        );
      }

      function ThemeToggle(){
        const [theme, setTheme] = useState('dark');
        useEffect(()=>{ const saved = localStorage.getItem('theme') || 'dark'; setTheme(saved); document.documentElement.classList.toggle('dark', saved==='dark'); },[]);
        const toggle = () => { const next = theme==='dark'?'light':'dark'; setTheme(next); localStorage.setItem('theme', next); document.documentElement.classList.toggle('dark', next==='dark'); };
        return (
          <button title={`Switch to ${theme==='dark'?'light':'dark'} mode`} onClick={toggle} className="fixed top-4 right-4 z-50 bg-slate-800/95 border border-slate-700/50 hover:bg-slate-700 rounded-lg px-3 py-2">{theme==='dark'?'🌞':'🌙'}</button>
        );
      }

      function Dashboard(){
        const { lastUpdate, isRefreshing, refresh, airQuality, incidents, stations, fireWeather, drought, alerts } = useMockData();
        const hotspots = useMemo(()=> stations.slice(0,8).map((s,i)=>({ confidence: i%3===0?'high': i%2===0?'nominal':'low', satellite: i%2?'VIIRS':'MODIS' })), [stations]);
        const byConf = useMemo(()=>({ high: hotspots.filter(h=>h.confidence==='high').length, nominal: hotspots.filter(h=>h.confidence==='nominal').length, low: hotspots.filter(h=>h.confidence==='low').length }), [hotspots]);
        const bySat = useMemo(()=>({ VIIRS: hotspots.filter(h=>h.satellite==='VIIRS').length, MODIS: hotspots.filter(h=>h.satellite==='MODIS').length }), [hotspots]);
        return (
          <div className="min-h-screen p-4 md:p-8">
            <ThemeToggle />

            <div className="max-w-7xl mx-auto">
              {/* Header */}
              <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                <div>
                  <h1 className="text-3xl md:text-4xl font-bold text-white mb-2">Five Forks Fire Weather Dashboard</h1>
                  <p className="text-slate-400">Real‑time monitoring from 11 regional weather stations</p>
                </div>
                <div className="flex items-center gap-3">
                  <div className="text-right">
                    <p className="text-xs text-slate-500">Last updated</p>
                    <p className="text-sm text-slate-300 font-medium">{timeSince(lastUpdate)}</p>
                  </div>
                  <Button onClick={refresh} disabled={isRefreshing}>{isRefreshing?'⟳':'⟳'} Refresh</Button>
                </div>
              </div>

              {/* NWS Alerts */}
              <div className="mb-8"><NWSAlertBanner alerts={alerts} /></div>

              {/* Alert bar if incidents */}
              {incidents?.length>0 && (
                <div className="mb-8 p-4 bg-red-500/10 border-2 border-red-500/50 rounded-xl backdrop-blur-sm">
                  <div className="flex items-center gap-3">
                    <div className="text-red-400 text-xl animate-pulse">⚠️</div>
                    <div>
                      <h3 className="text-red-400 font-bold text-lg">Active Fire Alert</h3>
                      <p className="text-slate-300 text-sm">{incidents.length} active fire incident{incidents.length!==1?'s':''} detected in the area</p>
                    </div>
                  </div>
                </div>
              )}

              {/* Top metrics */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <MetricsCard title="Active Fires" value={incidents?.length||0} status={incidents?.length>0?'danger':'good'} description="Within 50 miles" />
                <MetricsCard title="Temperature" value={airQuality?.temperature??'--'} unit="°F" status={airQuality&&airQuality.temperature>85?'warning':'good'} description="Regional average" />
                <MetricsCard title="Wind Speed" value={airQuality?.wind_speed??'--'} unit="mph" status={airQuality&&airQuality.wind_speed>15?'warning':'good'} description={airQuality?.wind_direction||'N/A'} />
                <MetricsCard title="Humidity" value={airQuality?.humidity??'--'} unit="%" status={airQuality&&airQuality.humidity<30?'warning':'good'} />
              </div>

              <div className="grid lg:grid-cols-3 gap-6 mb-8">
                <div className="lg:col-span-2 space-y-6">
                  <ActiveAlerts incidents={incidents} />
                  <WeatherStationsList stations={stations} />
                </div>
                <div className="space-y-6">
                  <Card className={cn('border-2', hotspots.length>20?'border-red-500/50 shadow-lg shadow-red-500/20': hotspots.length>10?'border-orange-500/50':'border-slate-700/50')}>
                    <CardHeader><CardTitle>NASA FIRMS Hotspots</CardTitle></CardHeader>
                    <CardContent className="space-y-4">
                      <div className="text-center py-6">
                        <div className="flex items-center justify-center gap-3 mb-2"><div className={cn('text-4xl', hotspots.length>20?'text-red-400 animate-pulse': hotspots.length>10?'text-orange-400':'text-yellow-400')}>🔥</div><div className="text-6xl font-bold text-white">{hotspots.length}</div></div>
                        <p className="text-slate-400 text-sm">Active hotspots detected (24h)</p>
                      </div>
                      <div className="grid grid-cols-3 gap-3">
                        <div className="text-center p-3 bg-slate-900/50 rounded-lg border border-slate-700/50"><p className="text-2xl font-bold text-red-400">{byConf.high}</p><p className="text-xs text-slate-500 mt-1">High</p></div>
                        <div className="text-center p-3 bg-slate-900/50 rounded-lg border border-slate-700/50"><p className="text-2xl font-bold text-yellow-400">{byConf.nominal}</p><p className="text-xs text-slate-500 mt-1">Nominal</p></div>
                        <div className="text-center p-3 bg-slate-900/50 rounded-lg border border-slate-700/50"><p className="text-2xl font-bold text-slate-400">{byConf.low}</p><p className="text-xs text-slate-500 mt-1">Low</p></div>
                      </div>
                      <div className="space-y-2">
                        <p className="text-xs text-slate-500 uppercase font-semibold">Satellite Sources</p>
                        <div className="flex gap-2 flex-wrap">
                          {bySat.VIIRS>0 && <Badge className="bg-blue-500/20 text-blue-400 border-blue-500/30">VIIRS: {bySat.VIIRS}</Badge>}
                          {bySat.MODIS>0 && <Badge className="bg-green-500/20 text-green-400 border-green-500/30">MODIS: {bySat.MODIS}</Badge>}
                        </div>
                      </div>
                      {hotspots.length>15 && (
                        <div className="p-3 bg-red-500/10 border-2 border-red-500/30 rounded-lg"><div className="flex items-center gap-2 text-red-400 font-bold text-sm">▲ Elevated Activity Detected</div><p className="text-xs text-slate-300 mt-1">Multiple heat signatures detected in the region</p></div>
                      )}
                      <div className="text-xs text-slate-500 pt-3 border-t border-slate-700/50">Data from NASA FIRMS (VIIRS, MODIS)</div>
                    </CardContent>
                  </Card>
                  <AirQualityCard data={airQuality} />
                  <FireWeatherPanel fireWeather={fireWeather} drought={drought} />
                </div>
              </div>

              <TrendsChart />

              <div className="mt-8 p-6 bg-slate-800/30 backdrop-blur-sm rounded-xl border border-slate-700/50">
                <div className="grid md:grid-cols-3 gap-6 text-center">
                  <div><p className="text-slate-500 text-sm mb-1">Data Sources</p><p className="text-slate-300 font-semibold">Weather Underground, WFAS, NWS, NASA FIRMS</p></div>
                  <div><p className="text-slate-500 text-sm mb-1">Update Frequency</p><p className="text-slate-300 font-semibold">Every 15 Minutes</p></div>
                  <div><p className="text-slate-500 text-sm mb-1">Regional Coverage</p><p className="text-slate-300 font-semibold">11 Weather Stations</p></div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<Dashboard />);
    </script>
  </body>
</html>
